name: ROS2 CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up ROS 2
        uses: ros-tooling/setup-ros@v0.12
        with:
          version: noble

      - name: Update apt and install dependencies
        run: sudo apt update && sudo apt install -y python3-rosdep python3-colcon-common-extensions

      - name: Initialize rosdep
        run: |
          sudo rosdep init || true
          rosdep update

      - name: Create ROS2 workspace
        run: |
          mkdir -p ~/ros2_ws/src
          cd ~/ros2_ws
          # もしパッケージをコピーしたい場合
          cp -r $GITHUB_WORKSPACE/* src/

      - name: Install ROS2 dependencies
        run: |
          cd ~/ros2_ws
          rosdep install --from-paths src --ignore-src -y

      - name: Build workspace
        run: |
          cd ~/ros2_ws
          colcon build

